<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>GatAI v. X-Mas-3 - 2&nbsp; Abstracting X-Mas-3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./model-training.html" rel="next">
<link href="./x-mas-3-description.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="stylesheet" media="screen" href="https://fonts.googleapis.com/css?family=JetBrains Mono" type="text/css">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./abstracting-x-mas-3.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Abstracting X-Mas-3</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">GatAI v. X-Mas-3</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./x-mas-3-description.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The Game</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./abstracting-x-mas-3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Abstracting X-Mas-3</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model-training.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model Training</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./full-board-strategies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Full Board Strategies</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./computer-vision-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Computer Vision</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./showdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The Showdown</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./implementation-and-scalability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Scalability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./business-case.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Business Cases</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#abstracting-the-board-and-tiles" id="toc-abstracting-the-board-and-tiles" class="nav-link active" data-scroll-target="#abstracting-the-board-and-tiles"><span class="header-section-number">2.1</span> Abstracting the Board and Tiles</a>
  <ul class="collapse">
  <li><a href="#checking-for-combinations" id="toc-checking-for-combinations" class="nav-link" data-scroll-target="#checking-for-combinations">Checking for Combinations</a></li>
  <li><a href="#initial-board-state" id="toc-initial-board-state" class="nav-link" data-scroll-target="#initial-board-state">Initial Board State</a></li>
  <li><a href="#making-moves" id="toc-making-moves" class="nav-link" data-scroll-target="#making-moves">Making Moves</a></li>
  </ul></li>
  <li><a href="#applying-reinforcement-learning" id="toc-applying-reinforcement-learning" class="nav-link" data-scroll-target="#applying-reinforcement-learning"><span class="header-section-number">2.2</span> Applying Reinforcement Learning</a>
  <ul class="collapse">
  <li><a href="#specifying-our-spaces" id="toc-specifying-our-spaces" class="nav-link" data-scroll-target="#specifying-our-spaces">Specifying our Spaces</a></li>
  <li><a href="#reducing-our-spaces" id="toc-reducing-our-spaces" class="nav-link" data-scroll-target="#reducing-our-spaces">Reducing our Spaces</a></li>
  <li><a href="#caveats" id="toc-caveats" class="nav-link" data-scroll-target="#caveats">Caveats</a></li>
  </ul></li>
  <li><a href="#algebraic-notation" id="toc-algebraic-notation" class="nav-link" data-scroll-target="#algebraic-notation"><span class="header-section-number">2.3</span> Algebraic Notation</a></li>
  <li><a href="#transpositions" id="toc-transpositions" class="nav-link" data-scroll-target="#transpositions"><span class="header-section-number">2.4</span> Transpositions</a>
  <ul class="collapse">
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">Examples</a></li>
  </ul></li>
  <li><a href="#windowing-and-sliding" id="toc-windowing-and-sliding" class="nav-link" data-scroll-target="#windowing-and-sliding"><span class="header-section-number">2.5</span> Windowing and Sliding</a>
  <ul class="collapse">
  <li><a href="#examples-1" id="toc-examples-1" class="nav-link" data-scroll-target="#examples-1">Examples</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Abstracting X-Mas-3</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In order to analyze <em>x-mas-3</em> and training an AI to play the game, we decided to make an <em>abstract</em> version in the game in R <span class="citation" data-cites="Rlanguage">(<a href="#ref-Rlanguage" role="doc-biblioref">R Core Team 2023</a>)</span> and C++ <span class="citation" data-cites="ISO:2012:III">(<a href="#ref-ISO:2012:III" role="doc-biblioref">ISO 2012</a>)</span>. The abstracted version is more suitable for computer-game interaction as it will communicate only the relevant information between the agent and the game. This will be substantially faster than interacting with the UI and allow for a more streamlined training process.</p>
<section id="abstracting-the-board-and-tiles" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="abstracting-the-board-and-tiles"><span class="header-section-number">2.1</span> Abstracting the Board and Tiles</h2>
<p>The board is a 6 by 10 grid each containing a tile out of ten different tile-types. For our purposes we represent the board as a 6x10 matrix with the letters A through J representing the ten different tiles. An example board would me represented thus:</p>
<span class="math display">\[\begin{bmatrix} G &amp; C &amp; J &amp; D &amp; G &amp; G &amp; C &amp; G &amp; B &amp; A \\ I &amp; D &amp; E &amp; A &amp; C &amp; B &amp; H &amp; C &amp; E &amp; F \\ J &amp; C &amp; J &amp; F &amp; C &amp; J &amp; A &amp; H &amp; B &amp; F \\ H &amp; C &amp; D &amp; F &amp; C &amp; F &amp; D &amp; B &amp; G &amp; B \\ D &amp; I &amp; H &amp; I &amp; I &amp; B &amp; F &amp; C &amp; C &amp; E \\ B &amp; F &amp; A &amp; J &amp; E &amp; H &amp; I &amp; C &amp; H &amp; G \end{bmatrix}\]</span>
<section id="checking-for-combinations" class="level3">
<h3 class="anchored" data-anchor-id="checking-for-combinations">Checking for Combinations</h3>
<p>Using this structure we can check for the presence of combinations using regular expressions. Using</p>
<p><span class="math display">\[
\text{([A-J])\\1\\1+}
\]</span></p>
<p>as a regular expression will identify three or more consecutive occurrences of similar tiles. Implemented in R below:</p>
<div class="cell" data-code-block-border-left="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>get_n_combinations <span class="ot">&lt;-</span> \(m){</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  my_regex <span class="ot">&lt;-</span> <span class="st">"([A-J])</span><span class="sc">\\</span><span class="st">1</span><span class="sc">\\</span><span class="st">1+"</span>  </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    rowmatch <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_lgl</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,<span class="sc">~</span>{</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    my_str <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_c</span>(m[.x,], <span class="at">collapse =</span> <span class="st">""</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(my_regex,my_str) </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  colmatch <span class="ot">&lt;-</span>purrr<span class="sc">::</span><span class="fu">map_lgl</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="sc">~</span>{</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(my_regex,stringr<span class="sc">::</span><span class="fu">str_c</span>(m[,.x], <span class="at">collapse =</span> <span class="st">""</span>)) </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(colmatch,rowmatch)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In this case one match is returned because of the triple “C”s found in column 5.</p>
</section>
<section id="initial-board-state" class="level3">
<h3 class="anchored" data-anchor-id="initial-board-state">Initial Board State</h3>
<p>Since the initial state of the board cannot include any scoring combination we need a function that generates a random initial state <em>until</em> the board’s score is zero. We implemented this recursively.</p>
<div class="cell" data-code-block-border-left="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>initialize_board <span class="ot">&lt;-</span> \(){</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  tiles <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a> board <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="fu">sample</span>(tiles,<span class="dv">60</span>,<span class="at">replace =</span> <span class="cn">TRUE</span>),<span class="dv">6</span>,<span class="dv">10</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## If the initial state scores, generate another one</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">get_n_combinations</span>(board)<span class="sc">&gt;</span><span class="dv">0</span>){</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    board <span class="ot">&lt;-</span> <span class="fu">initialize_board</span>()</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a> board</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">initialize_board</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="making-moves" class="level3">
<h3 class="anchored" data-anchor-id="making-moves">Making Moves</h3>
<p>Moves are made by specifying a cell, (by clicking on it) and then switching it with one of it’s neighbors directly above, below, to the left or to the right. When a move is made the neighboring tile switches places with the first one clicked.</p>
</section>
</section>
<section id="applying-reinforcement-learning" class="level2 page-columns page-full" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="applying-reinforcement-learning"><span class="header-section-number">2.2</span> Applying Reinforcement Learning</h2>
<p>Reinforcement Learning (RL) <span class="citation" data-cites="watkins1992q">(<a href="#ref-watkins1992q" role="doc-biblioref">Watkins and Dayan 1992</a>)</span> is an algorithm that allows an agent (i.e.&nbsp;AI) to interact with an environment over a sequence of observations. The agent seeks to be rewarded and for the reward to be maximized over time. The model consists of a set of environment states <span class="math inline">\(S\)</span> a set of actions <span class="math inline">\(A\)</span> and a set of rewards <span class="math inline">\(R\)</span> (positive or negative).</p>
<p>The algorithm is guaranteed to converge to an optimal policy for each possible state in <span class="math inline">\(S\)</span>. RL (and in this case we will use Q-learning) needs to be trained on a set of state-transition <em>tuples</em> formally defined in <a href="#eq-tuples" class="quarto-xref"><span class="quarto-unresolved-ref ref-noprefix">eq-tuples</span></a>. <span id="eq-tuples"><span class="math display">\[
(s_i, a_i, r_{i+1}, s_{i+1})
\tag{2.1}\]</span></span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(s_i\)</span> is the current environment state,</li>
<li><span class="math inline">\(a_i\)</span> is selected action in the current state,</li>
<li><span class="math inline">\(r_{i+1}\)</span> represents the reward, and,</li>
<li><span class="math inline">\(s_{i+1}\)</span> is the resulting state.</li>
</ul>
<section id="specifying-our-spaces" class="level3">
<h3 class="anchored" data-anchor-id="specifying-our-spaces">Specifying our Spaces</h3>
<p>For <span class="math inline">\(S\)</span> we have ten possibilities for each of the 60 (<span class="math inline">\(6\times10\)</span>) cells on our board. For <span class="math inline">\(A\)</span> the agent can make one out of four moves in each of the 60 cells (ignoring for the moment the marginal cases of moving off the board, which is not possible). As for the reward space <span class="math inline">\(R\)</span>, this can probably be set to the actual scores of the game, with some smaller penalty for making a non-scoring move or <em>Passing</em> (subsequent analysis will make it clear why this needs to be a possibility for practical purposes).</p>
</section>
<section id="reducing-our-spaces" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="reducing-our-spaces">Reducing our Spaces</h3>
<p>For our <span class="math inline">\(S\)</span> as defined above the number of possible states is <span class="math inline">\(10^{60}\)</span>, which is a 1 followed by 60 zeros, i.e.:</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
      |\__/,|   (`\
    _.|o o  |_   ) )
---(((---(((---------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Wow, that's a huge number!</code></pre>
</div>
</div>
</div></div><p><span class="math inline">\(10^{60}\)</span> = 1,000, 000, 000, 000, 000, 000, 000, 000, 000, 000, 000, 000, 000, 000, 000, 000, 000, 000, 000, 000.</p>
<p>The action space <span class="math inline">\(A\)</span> is slightly smaller since there are only four possibilities for each cell, so we have “only” <span class="math inline">\(4^{60}\)</span> which is roughly equal to <span class="math inline">\(1.329\times10^{36}\)</span>.</p>
<p>Given the magnitude of these numbers it is clear that we cannot reasonably expect the algorithm to converge for several millennia with the computing power currently at our disposal. We therefore need to employ some strategies for reducing the spaces.</p>
<section id="one-type-at-a-time" class="level4">
<h4 class="anchored" data-anchor-id="one-type-at-a-time">One Type at a Time</h4>
<p>We can consider a one-type-at-a-time strategy. The heuristic implemented would then be to first look for moves involving <em>candy</em>, then move on to <em>trees</em> and so on. For example: staring with an initial board like this:</p>
<span class="math display">\[\begin{bmatrix} G &amp; C &amp; J &amp; D &amp; G &amp; G &amp; C &amp; G &amp; B &amp; A \\ I &amp; D &amp; E &amp; A &amp; C &amp; B &amp; H &amp; C &amp; E &amp; F \\ J &amp; C &amp; J &amp; F &amp; C &amp; J &amp; A &amp; H &amp; B &amp; F \\ H &amp; C &amp; D &amp; F &amp; C &amp; F &amp; D &amp; B &amp; G &amp; B \\ D &amp; I &amp; H &amp; I &amp; I &amp; B &amp; F &amp; C &amp; C &amp; E \\ B &amp; F &amp; A &amp; J &amp; E &amp; H &amp; I &amp; C &amp; H &amp; G \end{bmatrix}\]</span>
<p>And chose to consider the “A” cells we get:</p>
<span class="math display">\[\begin{bmatrix} 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\ 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 1 &amp; 0 \\ 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 1 &amp; 0 &amp; 0 \end{bmatrix}\]</span>
<p>This reduces the problem to a binary one and we effectively reduce <span class="math inline">\(S\)</span> to <span class="math inline">\(2^{60}\)</span>, which is <em>merely</em> 1.15 quintillions. While this represents a huge reduction, it is still far from being feasible. In addition this does not reduce our action space <span class="math inline">\(A\)</span>, as you still have four possible moves for each of the 60 cells.</p>
</section>
<section id="windowing" class="level4">
<h4 class="anchored" data-anchor-id="windowing">Windowing</h4>
<p>We can further reduce our problem space by applying a technique known as <em>windowing</em>. This implies dividing the grid into sub-grids and looking for playable moves within those reduced spaces. If we first consider the quest for a three-tile combinations, the windows in question would be a <span class="math inline">\(3\times2\)</span> and a <span class="math inline">\(2\times3\)</span> sub-matrix for perpendicular (<span class="math inline">\(\perp\)</span>)moves. For parallel (<span class="math inline">\(\parallel\)</span>) moves, i.e.&nbsp;moves with the same row or column we would have to consider <span class="math inline">\(1\times4\)</span> and <span class="math inline">\(4\times1\)</span> respectively. Examples are shown below.</p>
<span class="math display">\[\begin{bmatrix} 1 &amp; 1 &amp; 0 \\ 0 &amp; 1 &amp; 1 \end{bmatrix}
%
\text{ or}
%
\begin{bmatrix} 1 &amp; 0 \\ 1 &amp; 1 \\ 0 &amp; 1 \end{bmatrix}
%
\text{ for }\perp\text{moves,}\]</span>
<p>and</p>
<span class="math display">\[\begin{bmatrix} 1 &amp; 1 &amp; 0 &amp; 1 \end{bmatrix}
%
\text{ or}
%
\begin{bmatrix} 1 \\ 1 \\ 0 \\ 1 \end{bmatrix}
%
\text{ for }\parallel \text{ moves.}\]</span>
<p>Is it easy to see that the <span class="math inline">\(3\times2\)</span> matrix above is a transposition of the <span class="math inline">\(2\times3\)</span> one, and therefore it does not matter whether a move if horizontal or vertical the problem is similar in nature for all <em>perpendicular</em> moves. The same is true for the <span class="math inline">\(4\times1\)</span> and <span class="math inline">\(1\times4\)</span> matrices, i.e.&nbsp;where there is a winning <em>parallel</em> move. Matrix <a href="#eq-example-windows" class="quarto-xref"><span class="quarto-unresolved-ref ref-noprefix">eq-example-windows</span></a> illustrates two windows on our original board and Matrix <a href="#eq-example-windows-binary" class="quarto-xref"><span class="quarto-unresolved-ref ref-noprefix">eq-example-windows-binary</span></a> shows the same in our binary space (combining the two reduction strategies).</p>
<p><span id="eq-example-windows"><span class="math display">\[
\begin{bmatrix} G &amp; \color{red}{\textbf{C}} &amp; \color{red}{\textbf{J}} &amp; \color{red}{\textbf{D}} &amp; \color{red}{\textbf{G}} &amp; G &amp; C &amp; G &amp; B &amp; A \\ I &amp; D &amp; E &amp; A &amp; C &amp; B &amp; H &amp; C &amp; E &amp; F \\ J &amp; C &amp; J &amp; F &amp; C &amp; J &amp; \color{red}{\textbf{A}} &amp; \color{red}{\textbf{H}} &amp; B &amp; F \\ H &amp; C &amp; D &amp; F &amp; C &amp; F &amp; \color{red}{\textbf{D}} &amp; \color{red}{\textbf{B}} &amp; G &amp; B \\ D &amp; I &amp; H &amp; I &amp; I &amp; B &amp; \color{red}{\textbf{F}} &amp; \color{red}{\textbf{C}} &amp; C &amp; E \\ B &amp; F &amp; A &amp; J &amp; E &amp; H &amp; I &amp; C &amp; H &amp; G \end{bmatrix}
\tag{2.2}\]</span></span></p>
<p><span id="eq-example-windows-binary"><span class="math display">\[
\begin{bmatrix}
0 &amp; \color{red}{\textbf{1}} &amp; \color{red}{\textbf{0}} &amp; \color{red}{\textbf{0}} &amp; \color{red}{\textbf{0}} &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; \color{red}{\textbf{0}} &amp; \color{red}{\textbf{0}} &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; \color{red}{\textbf{0}} &amp; \color{red}{\textbf{0}} &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \color{red}{\textbf{0}} &amp; \color{red}{\textbf{1}} &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0
\end{bmatrix}
\tag{2.3}\]</span></span></p>
</section>
<section id="the-reduced-action-spaces" class="level4">
<h4 class="anchored" data-anchor-id="the-reduced-action-spaces">The Reduced Action Spaces</h4>
<p>If we employ the windowed approach suggested above, our action space, <span class="math inline">\(A\)</span> shrinks significantly. We will in fact have two different <span class="math inline">\(S\)</span> and <span class="math inline">\(A\)</span> depending on whether we are considering parallel or perpendicular moves.</p>
<p>For a parallel window, we can generalize to the horizontal variant (since the horizontal one is a simple transposition thereof) and we then get only a few relevant combinations. Since any four element set which already has three in a row is will not occur, we are left with: {0000,0001,0010,0011,0100,0101,0110,1000,1001,1011, 1101} for a total of 11 cases out of which only two have a winning move ({1011, 1101}). This reduces <span class="math inline">\(A_{\parallel}\)</span> for <span class="math inline">\(S_{\parallel}\)</span> to three moves: pass (P), flip first (F) or flip last (L). formalized in <a href="#eq-action-space-parallel" class="quarto-xref">Equation&nbsp;<span class="quarto-unresolved-ref">eq-action-space-parallel</span></a>.</p>
<p><span id="eq-action-space-parallel"><span class="math display">\[
A_{\parallel} = \{P,F,L\}
\tag{2.4}\]</span></span></p>
<p>For the perpendicular case we 62 combinations, these are illustrated in <a href="#eq-perpendicular-combinations" class="quarto-xref">Equation&nbsp;<span class="quarto-unresolved-ref">eq-perpendicular-combinations</span></a>.</p>
<p><span id="eq-perpendicular-combinations"><span class="math display">\[
S_{\perp} = \Biggl\{ \left[{000\atop{000}}\right],
\left[{000\atop{001}}\right],
\left[{000\atop{010}}\right] ...
\left[{001\atop{001}}\right],
\left[{001\atop{010}}\right]...
\left[{110\atop{011}}\right]
\Biggr\}
\tag{2.5}\]</span></span></p>
<p>The action space is limited to flipping one out of three positions, First, Middle, Last, or Passing. Illustrated in <a href="#eq-action-space-perpendicular" class="quarto-xref">Equation&nbsp;<span class="quarto-unresolved-ref">eq-action-space-perpendicular</span></a>.</p>
<p><span id="eq-action-space-perpendicular"><span class="math display">\[
A_{\perp}=\{F,M,L,P\}
\tag{2.6}\]</span></span></p>
</section>
</section>
<section id="caveats" class="level3">
<h3 class="anchored" data-anchor-id="caveats">Caveats</h3>
<p>The windowed approach proposed above, along with the one-type-at-a-time technique reduce our <span class="math inline">\(A\)</span> and <span class="math inline">\(S\)</span> to magnitudes that are manageable and allow us to generate a training set. They do limit the potential for the agent in some non-trivial ways, namely:</p>
<ol type="1">
<li>The Agent will only look for combinations of three tiles, and</li>
<li>The agent will only look one move ahead.</li>
</ol>
<p>In view of (2) the more precise description of our endeavor is perhaps to say that we are teaching it <em>tactics</em> rather than <em>strategy</em>.</p>
<p>We will later see if it is feasible to generalize this approach and create larger grids.</p>
</section>
</section>
<section id="algebraic-notation" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="algebraic-notation"><span class="header-section-number">2.3</span> Algebraic Notation</h2>
<p>In order to facilitate the discussion and analysis of positions and moves I decided to use notation inspired by <em>algebraic notation</em> in the game of <em>chess</em>. Our board is 6x10 (as opposed to 8x8 in chess), so we have columns A through J, and rows 1 through 6. Since there is a component of “gravity” in the game, i.e.&nbsp;tiles fall toward the botton of the screen when tiles are removed from the board, I decided to number rows from the top. This would be congruent with the typical layout of a chess board, but seen from the perpective of the black pieces. An example can be seen in <a href="#fig-example-board-algebraic-notation" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-example-board-algebraic-notation</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-example-board-algebraic-notation" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-example-board-algebraic-notation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="abstracting-x-mas-3_files/figure-html/fig-example-board-algebraic-notation-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-example-board-algebraic-notation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.1: An Example Board
</figcaption>
</figure>
</div>
</div>
</div>
<p>Moving the top-left tile to the adjecent square to the right would be denoted: “A1 to B1” or simply “A1B1”. The move is illustrated in <a href="#fig-example-move" class="quarto-xref">Figure&nbsp;<span class="quarto-unresolved-ref">fig-example-move</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-example-move" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-example-move-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="abstracting-x-mas-3_files/figure-html/fig-example-move-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-example-move-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.2: The Move A1 to B1
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="transpositions" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="transpositions"><span class="header-section-number">2.4</span> Transpositions</h2>
<p>Since the strategies and tactics learned on a i.e.&nbsp;3x4 board are in principle the same as those of a 4x3 board it is useful to be able to transpose both boards and moves. We therefore implemented transpose-functions for both.</p>
<section id="examples" class="level3">
<h3 class="anchored" data-anchor-id="examples">Examples</h3>
<div id="fig-transpositions" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-transpositions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-transpositions" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-transpositions-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-transpositions-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="abstracting-x-mas-3_files/figure-html/fig-transpositions-1.png" class="img-fluid figure-img" data-ref-parent="fig-transpositions" width="288">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-transpositions-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Original
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-transpositions" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-transpositions-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-transpositions-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="abstracting-x-mas-3_files/figure-html/fig-transpositions-2.png" class="img-fluid figure-img" data-ref-parent="fig-transpositions" width="288">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-transpositions-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Transposed
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-transpositions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.3: Transposition example
</figcaption>
</figure>
</div>
</section>
</section>
<section id="windowing-and-sliding" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="windowing-and-sliding"><span class="header-section-number">2.5</span> Windowing and Sliding</h2>
<p>Another class of transpositions applies to those that are either horizontal or vertical, but do not imply a flip around the matrix’s diagonal. For the avoidance of confusion I chose to denominate these operations as <em>sliding.</em> And the origin area of a <em>slide</em> a <em>window.</em></p>
<p>Since we are operating on simplified sub-boards, and part of our strategy is to window the playing-board we implemented functions to <em>window</em> a board, i.e.&nbsp;subdivide it into smaller pieces for analysis. When moves are suggested for the sub-division we need to <em>slide</em> these moves over on the real playing board (i.e.&nbsp;the larger one).</p>
<section id="examples-1" class="level3">
<h3 class="anchored" data-anchor-id="examples-1">Examples</h3>
<div id="fig-window-example" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-window-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-window-example" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-window-example-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-window-example-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="abstracting-x-mas-3_files/figure-html/fig-window-example-1.png" class="img-fluid figure-img" data-ref-parent="fig-window-example" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-window-example-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Board with Window
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-window-example" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-window-example-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-window-example-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="abstracting-x-mas-3_files/figure-html/fig-window-example-2.png" class="img-fluid figure-img" data-ref-parent="fig-window-example" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-window-example-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Moves A1xA2 and B1xA1
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-window-example" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-window-example-3" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-window-example-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="abstracting-x-mas-3_files/figure-html/fig-window-example-3.png" class="img-fluid figure-img" data-ref-parent="fig-window-example" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-window-example-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Transitioned Moves
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-window-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.4: Example of windowing
</figcaption>
</figure>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-ISO:2012:III" class="csl-entry" role="listitem">
ISO. 2012. <em><span class="nocase">ISO/IEC 14882:2011 Information technology — Programming languages — C++</span></em>. Geneva, Switzerland: International Organization for Standardization. <a href="http://www.iso.org/iso/iso_catalogue/catalogue_tc/catalogue_detail.htm?csnumber=50372">http://www.iso.org/iso/iso_catalogue/catalogue_tc/catalogue_detail.htm?csnumber=50372</a>.
</div>
<div id="ref-Rlanguage" class="csl-entry" role="listitem">
R Core Team. 2023. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-watkins1992q" class="csl-entry" role="listitem">
Watkins, Christopher JCH, and Peter Dayan. 1992. <span>“Q-Learning.”</span> <em>Machine Learning</em> 8: 279–92.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./x-mas-3-description.html" class="pagination-link" aria-label="The Game">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The Game</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./model-training.html" class="pagination-link" aria-label="Model Training">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model Training</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>